-- 1.) Load the given dataset into snowflake with a primary key to Order Date column.
alter table SALES_DATA
ADD PRIMARY KEY (order_date);


-- Change the Primary key to Order Id Column.
ALTER TABLE SALES_DATA
DROP PRIMARY KEY;

alter table SALES_DATA
ADD PRIMARY KEY (order_id);


-- 2.) Check the data type for Order date and Ship date and mention in what data type it should be?
alter table SALES_DATA
alter order_date set data type date;

alter table SALES_DATA
alter ship_date set data type date;


-- 3.) Create a new column called order_extract and extract the number after the last ‘–‘from Order ID column.
SELECT SPLIT_PART(ORDER_ID, '-', 3) AS order_extract
FROM SALES_DATA; 


-- 4.) Create a new column called Discount Flag and categorize it based on discount. Use ‘Yes’ if the discount is greater than zero else ‘No’.
select *, case
     when DISCOUNT>0 then 'YES'
     else 'NO'
   end as Discount_Flag
from SALES_DATA;


-- 5.) FIND OUT THE FINAL PROFIT AND PUT IT IN COLUMN FOR EVERY ORDER ID.
select *, sum(PROFIT) over() as Final_Profit from SALES_DATA;


--6.) Create a new column called process days and calculate how many days it takes for each order id to process from the order to its shipment.
select datediff(day,ORDER_DATE,SHIP_DATE) as process_days from SALES_DATA;  



-- 7.) Create a new column called Rating and then based on the Process dates give rating like given below.
--       a. If process days less than or equal to 3days then rating should be 5
--       b. If process days are greater than 3 and less than or equal to 6 then rating should be 4
--       c. If process days are greater than 6 and less than or equal to 10 then rating should be 3
--       d. If process days are greater than 10 then the rating should be 2.

select *,datediff(day,ORDER_DATE,SHIP_DATE) as process_days, 
case
      when process_days<=3 then '5'
      when process_days>3 and process_days<=6 then '4'
      when process_days>6 and process_days<=10 then '3'
      when process_days>10 then '2'
    else process_days
  end as Rating
from SALES_DATA;